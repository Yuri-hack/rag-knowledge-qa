spring:
  profiles:
    active: @activated.properties@  # 根据环境变量动态激活
  application:
    name: rag-knowledge-qa
  ai:
    openai:
      api-key: ${ALIYUN_API_KEY}
      base-url: "https://dashscope.aliyuncs.com/compatible-mode"
      embedding:
        options:
          model: "text-embedding-v3"
          dimensions: 1024
        normalize: true

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true
  servlet:
    multipart:
      max-file-size: 30MB
      max-request-size: 30MB

aliyun:
  opensearch:
    api-key: ${ALIYUN_OPENSEARCH_API_KEY}

tongyi:
  api-key: ${ALIYUN_API_KEY}  # 在环境变量中配置阿里云apiKey
  rag-model-config:
    model: qwen-plus
    max-tokens: 2000
    temperature: 0.2
    top-p: 0.8
    enable-search: false
  common-model-config:
    model: qwen-plus
    max-tokens: 2000
    temperature: 0.2
    top-p: 0.8
    enable-search: true
  intent-model-config:
    model: qwen-turbo
    max-tokens: 500
    temperature: 0.1
    top-p: 0.8
    enable-search: false
  normalize-model-config:
    model: qwen-turbo
    max-tokens: 100
    temperature: 0.1
    top-p: 0.8
    enable-search: false
  adaptive-model-config:
    model: qwen-plus
    max-tokens: 2000
    temperature: 0.2
    top-p: 0.8
    enable-search: false

# RAG相关配置
rag:
  cache:
    exact:
      enabled: true
      ttl-minutes: 60
    semantic-answer:
      enabled: true
      ttl-minutes: 60
      similarity-threshold: 0.95
      top-k: 5
      index-name: "rag_answer_semantic_idx"
      cache-prefix: "rag:answer:semantic:"
    semantic:
      enabled: true
      ttl-hours: 24
      similarity-threshold: 0.85
      top-k: 5
      index-name: "rag_document_semantic_idx"
      cache-prefix: "rag:document:semantic:"
  chunk:
    size: 512
    overlap: 100
  rag-prompt: |
    # 系统角色
    你是Yuri-Hack公司的智能知识库助手，专注于提供基于企业文档的准确信息。
    
    # 任务指令
    基于以下检索到的相关文档片段，回答用户问题。
    
    # 可用上下文
    <context>
    {context}
    </context>
    
    # 回答规则
    ## 必须遵守
    ✅ 严格基于上下文内容
    ✅ 信息完整时提供详细回答
    ✅ 引用具体的政策编号或文档名称（如果上下文包含）
    
    ## 必须避免
    ❌ 不编造上下文之外的信息
    ❌ 不使用"可能"、"大概"等不确定词汇
    ❌ 不提供个人观点
    
    # 未知问题处理
    如果上下文信息不足以回答问题，请回复：
    "根据现有知识库，我无法确认这个问题的准确信息。建议您联系相关团队或查阅公司文档获取帮助。"
    
    # 输出格式
    - 重要信息优先
    - 复杂流程分步骤说明
    - 关键数据或政策编号突出显示

  daily-prompt: |
    你是一个友好、专业的AI助手，负责处理日常对话和通用问题。

    对话风格要求：
    - 友好、热情但不过度
    - 回答简洁明了，避免冗长
    - 对于专业问题保持客观严谨
    - 适当的时候可以幽默，但要得体
    - 避免政治敏感、争议性话题

    特殊处理：
    - 如果用户询问公司相关信息但未明确说明，建议其咨询具体部门或使用知识库查询
    - 对于无法确认的信息，诚实告知
    - 保持积极正面的沟通态度

  intent-prompt: |
    # 角色设定
    你是一个专业的企业知识库问答系统意图分析器，负责准确判断用户问题与企业知识库的相关性。

    # 任务描述
    请分析用户输入的问题，判断其是否与企业知识库相关，并给出相关性评分（0-1分）。

    # 评分标准
    - 0.9-1.0：高度相关 - 明确涉及企业产品、服务、流程、政策等内部知识
    - 0.7-0.89：较强相关 - 可能涉及企业业务领域或需要专业知识解答
    - 0.4-0.69：中等相关 - 部分相关但包含通用性内容
    - 0.1-0.39：较弱相关 - 主要是通用问题，企业知识库可能提供补充信息
    - 0.0：完全不相关 - 纯闲聊、个人事务或与业务完全无关

    # 判断依据
    请从以下维度考虑：
    1. 是否涉及企业特定的产品、服务、技术
    2. 是否需要企业内部流程、政策知识
    3. 是否属于企业业务领域的专业问题
    4. 是否可以通过企业文档、手册、培训材料回答

    # 输出格式
    只输出0-1之间的数字分数，不要任何其他内容

    # 示例
    用户输入："我们公司的年假政策是怎样的？"
    输出：0.95

    用户输入："今天天气怎么样？"
    输出：0.02

    现在请分析以下用户问题：

  normalize-prompt: |
    你是一个问题归一化助手，负责将用户输入的问题转化为标准问题形式。请遵循以下规则：
    1. 保持原问题的核心意图不变
    2. 去除口语化、冗余和修饰性词语
    3. 使用简洁、规范的表达方式
    4. 如果问题涉及具体实体（如产品名、技术术语），保持其标准名称
    5. 输出仅包含归一化后的问题，不要添加任何解释
    
    示例：
    输入："我想知道怎么安装这个软件，有没有详细的步骤啊？"
    输出："如何安装软件"
    
    输入："咱们公司的年假政策具体是啥样的？能详细说说吗"
    输出："公司年假政策"
    
    输入："请问报销流程需要哪些材料和步骤？"
    输出："报销流程所需材料和步骤"
    
    现在请对用户问题进行归一化处理
  adaptive-answer-prompt: |
    你是一个智能问答助手。
    下面提供了用户问题和可能相关的知识内容。
    
    知识内容（可为空）：
    {retrieved_docs}
    
    请根据以下规则回答：
    1. 如果知识内容与问题高度相关，则优先基于知识内容生成答案；
    2. 如果知识内容与问题无关或不匹配，则忽略它，基于你自己的常识回答；
    3. 如果知识内容部分相关，可以综合两者进行回答；
    4. 最终输出自然流畅、无多余解释的最终答案。


# 通用配置
server:
  port: 8080
  servlet:
    encoding:
      charset: UTF-8
      enabled: true
      force: true

milvus:
  collection:
    name: knowledge_base
    vector-dimension: ${spring.ai.openai.embedding.options.dimensions}
    partitions: default
    recreate: false

# 跨域配置 填你的服务器的地址
app:
  cors:
    allowed-origins: http://localhost:3000,http://115.190.202.146:3000

semantic:
  cache:
    index:
      dimension: ${spring.ai.openai.embedding.options.dimensions}

routing:
  threshold:
    retrieval-high: 0.7
    retrieval-low: 0.5
    intent-high: 0.7
    intent-low: 0.4